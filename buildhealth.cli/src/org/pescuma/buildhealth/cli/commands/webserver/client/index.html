<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/icons/buildhealth.png">

    <title>buildhealth report</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="index.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">buildhealth</a>
        </div>
        <!-- div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div> -->
      </div>
    </div>

	<div class="container build" style="display: none">
		<div style="margin-top: 40px;">
			<h1><img height="80px" class="main-img"></img> <span class="main-text"></span></h1>
		</div>
		<div style="margin-top: 20px; margin-left: 40px; display: none; height: 64px" class="item-template">
			<img height="64px" style="margin-right: 10px; float: left" class="item-img">
			<h2 class="item-text"></h2>
			<h4 class="item-details"></h4>
		</div>
	</div>

	<div class="container item" style="display: none">
		<div style="margin-top: 40px;">
			<h1><img height="80px" class="main-img"></img> <span class="main-text"></span></h1>
		</div>
		<div style="margin-top: 20px; margin-left: 40px; display: none; height: 64px" class="item-template">
			<img height="64px" style="margin-right: 10px; float: left" class="item-img">
			<h2 class="item-text"></h2>
			<h4 class="item-details"></h4>
		</div>
	</div>


		<!-- Bootstrap core JavaScript
		================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/jquery.address-1.6.js"></script>
		<script language="javascript">

var report = null;

$( document ).ready(function() {

	$.getJSON("/report.json")
	.fail(function() {
		$("#build-text").text("Error fetching report");
	})
	.done(function(data) {
		report = data;
		fillBuildHTML();
		setupPathChange();
	})
	;
});

function setupPathChange() {
	$.address.change(function(event) {
		if (event.path == '/') {
			switchToBuild();
			
		} else {
			var child = findChild(event.pathNames[0]);
			if (child) 
				switchToInternal(child);
			else
				$.address.value('/');
		}
	});
}

function findChild(name) {
	for(var i in report.children) {
		var child = report.children[i];
		if (child.name == name)
			return child;
	}
}

function switchToBuild() {
	$(".item").hide();
	$(".build").show();
}

function fillBuildHTML() {
	$(".item").hide();

	var panel = $(".build"); 	
	panel.find(".main-text").text("Your build is " + createTitle(report.status));
	panel.find(".main-img").attr("src", createIcon("build", report.status));
	
	var template = panel.find(".item-template");
	for(var i in report.children) {
		var child = report.children[i];
		var line = template.clone();
		
		line.attr("id", "item-" + i);
		line.attr("class", "item-" + i);
		line.addClass("item-div")
		line.find(".item-text").text(fullText(child));
		line.find(".item-details").text(child.description);
		line.find(".item-img").attr("src", createIcon(child.name, child.status));
		
		line.click(function(obj) {
			var i = $(this).attr("id").substring(5);
			$.address.value('/' + report.children[i].name);  
		});

		line.show();
		line.appendTo(".build");
	}

	panel.show();
}

function switchToInternal(data)
{
	$(".build").hide();

	var panel = $(".item"); 	
	panel.find(".main-text").text(fullText(data));
	panel.find(".main-img").attr("src", createIcon(data.name, data.status));

	panel.show();
}

function fullText(data) {
	return data.name + (data.value == "" ? "" : ": " + data.value)
}

function createTitle(status) {
	if (status == "Good")
		return "GOOD";
	if (status == "Problematic")
		return "PROBLEMATIC";
	if (status == "SoSo")
		return "So So";
}

function createIcon(type, status) {
	return "/icons/" + type.toLowerCase().replace(/ /g, "") + "-" + status.toLowerCase() + ".png";
}
	
		</script>
	</body>
</html>
